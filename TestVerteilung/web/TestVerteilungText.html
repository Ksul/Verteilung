<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script src="src/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="src/theme-chrome.js" type="text/javascript" charset="utf-8"></script>
    <script src="src/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
    <script src="src/mode-text.js" type="text/javascript" charset="utf-8"></script>
    <script src="verteilung.js" type="text/javascript" charset="utf-8"></script>
    <script src="recognition.js" type="text/javascript" charset="utf-8"></script>
    <script src="./jquery-ui-1.10.2/jquery-1.9.1.js" type="text/javascript" charset="utf-8"></script>
    <script src="yui-min.js" type="text/javascript" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="jquery.cookie.js" charset="utf-8"></script>
    <script type="text/javascript" src="jquery.hotkeys.js" charset="utf-8"></script>
    <script type="text/javascript" src="jquery.jstree.js" charset="utf-8"></script>
    <!--<script src="row-expansion.js" type="text/javascript" charset="utf-8"></script>-->
    <style type="text/css">
        .yui3-skin-sam .yui3-datatable-table {
            border-collapse: separate;
            border-spacing: 0;
            font-family: arial, sans-serif;
            font-size: 10px;
        }
    </style>
    <script type="text/javascript" charset="utf-8">
        const scriptDoc = "8ab628ae-c8cb-4e37-bf31-846d60aec3a4";

        window.onload = function () {
            textEditor = ace.edit("inTxt");
            textEditor.setTheme("ace/theme/chrome");
            textEditor.setShowInvisibles(true);
            textEditor.setShowPrintMargin(false);
            jsMode = require("ace/mode/javascript").Mode;
            txtMode = require("ace/mode/text").Mode;
            textEditor.getSession().setMode(new txtMode());
            var zone = document.getElementById('inTxt');
            zone.addEventListener('dragover', handleDragOver, false);
            zone.addEventListener('drop', handleFileSelect, false);
            YUI({
                gallery: 'gallery-2012.08.08-20-03'
            }).use('datatable', 'gallery-datatable-row-expansion', callBack);
            var tree = $("#tree").jstree({
                "themes": {
                    "theme": "corral",
                    "dots": true,
                    "icons": true
                },
                "json_data": {
                    "ajax": {
                        "url": "/TestVerteilung/VerteilungServlet",
                        dataType: "json",
                        cache: false,
                        "data": function (n) {
                            return {
                                "function": "listFolderAsJSON",
                                "filePath": n.attr ? n.attr("id") : "",
                                "server": getServer(),
                                "username": getUser(),
                                "password": getPassword(),
                                "searchFolder": "true",
                                "withFolder": "true",
                                "proxyHost": getUrlParam("proxy"),
                                "proxyPort": getUrlParam("port")
                            };
                        }
                    }
                },
                "plugins": [ "themes", "json_data", "ui", "crrm", "dnd", "search", "types", "hotkeys", "contextmenu"]
            }).bind("select_node.jstree",function (event, data) {
                        if (data.rslt.obj.attr("rel") == "default") {
                            var dataString = {
                                "function": "getContent",
                                "documentId": data.rslt.obj.attr("id"),
                                "extract": "true",
                                "server": getServer(),
                                "username": getUser(),
                                "password": getPassword(),
                                "proxyHost": getUrlParam("proxy"),
                                "proxyPort": getUrlParam("port")
                            };
                            $.ajax({
                                type: "POST",
                                data: dataString,
                                cache: false,
                                datatype: "json",
                                url: "VerteilungServlet",
                                success: function (data) {
                                    if (data.success[0]) {
                                        window.parent.frames.cont.textEditor.getSession().setValue(data.result.toString());
                                        window.parent.alfrescoMode = false;
                                        manageControls();

                                    } else
                                        alert("Daten konnten nicht Ã¼bertragen werden: " + data.result[0]);
                                },
                                error: function (response) {
                                    try {
                                        var r = jQuery.parseJSON(response.responseText);
                                        alert("Fehler: " + r.Message + "\nStackTrace: " + r.StackTrace + "\nExceptionType: " + r.ExceptionType);
                                    } catch (e) {
                                        var str = "FEHLER:\n";
                                        str = str + e.toString() + "\n";
                                        for (var prop in e)
                                            str = str + "property: " + prop + " value: [" + e[prop] + "]\n";
                                        alert(str + "\n" + response.responseText);
                                    }
                                }
                            });
                        }
                    }).delegate("a", "click", function (event, data) {
                        event.preventDefault();
                    });
            window.parent.treeObject = jQuery.jstree._reference(tree);

            window.parent.workDocument = null;
            multiMode = false;
            currentPDF = false;
            showMulti = false;
            currentFile = null;
            currentContainer = null;
        };
    </script>
</head>
<body>
<div class="example yui3-skin-sam">
    <div id="dtable"></div>
    <div id="labels"></div>
</div>
<div id="inTxt" style="height: 98%; width: 98%"></div>
<div id="tree"></div>
</body>
</html>