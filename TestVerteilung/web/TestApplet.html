<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="src/ace.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="./verteilung.js" charset="utf-8"></script>
    <script type="text/javascript" src="jquery-1.9.1.js"></script>
    <script type="text/javascript" src="jquery-ui-1.10.3.custom.js"></script>
    <script>
        $(function() {
            $( document ).tooltip();
        });
    </script>
    <style  type="text/css">
        .ui-tooltip {
            padding: 8px;
            position: absolute;
            z-index: 9999;
            max-width: 300px;
            -webkit-box-shadow: 0 0 5px #aaa;
            box-shadow: 0 0 5px #aaa;
        }
        body .ui-tooltip {
            border-width: 2px;
        }
    </style>
</head>
<body>
<div id="appl" width="0px"></div>
<TABLE BORDER=1 width="100%" id="t1">
    <TR>
    <TH width="20%">Test</TH>
    <TH width="20%">Call</TH>
    <TH>Ergebnis</TH>
    <TH width="3%">Status</TH>
    </TR>
    <script type="text/javascript">

    try {
        doTest("Lade Applet", 'loadApplet("FINE");', "typeof(erg) == 'undefined';");
        doTest("Test Applet", 'document.reader.test();', "erg == 'Hier ist das Verteilungs Applet!'");
        doTest("Test Applet", 'document.reader.testReturn();',"var result = $.parseJSON(erg); result.success;");
        var properties = doTest("Ermittlung Properties", '$.parseJSON(document.reader.loadProperties(convertPath("../test.properties"))).result', "typeof erg == 'object' &&  typeof erg.host == 'string' && typeof erg.bindingUrl == 'string' && typeof erg.password == 'string' ;");
        doTest("Host erreichbar",'document.reader.isURLAvailable(properties.host);', " var result = $.parseJSON(erg.toString()); if (result.success) result.result;");
        doTest("Setze Parameter", 'document.reader.setParameter(properties.bindingUrl, "admin", properties.password);', "var result = $.parseJSON(erg.toString()); result.success;");
        doTest("Check Archiv vorhanden Function getNodeId", "document.reader.getNodeId(\"/Archiv\");", "erg.toString().startsWith('{\"result\":\"workspace://SpacesStore');");
        doTest("Check Dokumenddefinition vorhanden Function getNodeId", "document.reader.getNodeId(\"/Datenverzeichnis/Skripte/doc.xml\");", "erg.toString().startsWith('{\"result\":\"workspace://SpacesStore');");
        doTest("Check Verteilungsskript vorhanden Function getNodeId", "document.reader.getNodeId(\"/Datenverzeichnis/Skripte/recognition.js\");", "erg.toString().startsWith('{\"result\":\"workspace://SpacesStore');");
        doTest("Check Dokument finden Function findDocument", "document.reader.findDocument(\"SELECT cmis:objectId from cmis:document where cmis:name='doc.xml'\");", "var result = $.parseJSON(erg.toString()); if (result.success){ var obj = $.parseJSON(result.result); (obj.name == 'doc.xml') };");
        doTest("Inhalt lesen Function getDocumentContent", "$.parseJSON(document.reader.getDocumentContent($.parseJSON(document.reader.getNodeId(\"/Datenverzeichnis/Skripte/doc.xml\")).result, false));", " if (erg.success){ erg.result.indexOf('xmlns:my=\"http://www.schulte.local/archiv\"'); };");
        doTest("Upload Document Function uploadDocument", "document.reader.uploadDocument(\"/Archiv\", properties.testPDF);", "var result = $.parseJSON(erg.toString()); result.success;");
        doTest("Delete Document Function deleteDocument", "document.reader.deleteDocument(\"/Archiv\", \"Test.pdf\");", "var result = $.parseJSON(erg.toString()); result.success;");
        doTest("Create Document Function createDocument", "document.reader.createDocument(\"/Archiv\", \"TestDocument.txt\", \"äöüßÄÖÜ/\", \"plain/text\", \"\");", "var result = $.parseJSON(erg.toString()); result.success;");
        var pdf = doTest("open File Function openFile", "document.reader.openFile(\"file://\" + properties.testPDF);", "var result = $.parseJSON(erg.toString()); result.success;");
        doTest("extract PDF Function extractPDF", "reader.extractPDF(\"file://\" + properties.testPDF);", "var result = $.parseJSON(erg.toString()); result.success;");
    } catch (e) {
        errorHandler(e);
    }
    function doTest(testName, testEvaluate, testExpected) {
        var erg;
        var test;
        var res;
        var testError = "";
        var success = '<a class="control" href="#" ><img  border="0" align="middle" alt="Fehler" src="./resource/ok.png" style="display: block; margin: 0px auto;"  /></a>';
        var error = '<a class="control" href="#" ><img  border="0" align="middle" alt="Fehler" src="./resource/error.png" style="display: block; margin: 0px auto;"  /></a>';
        var ergebnis = document.createElement("a");

        try {
            erg = eval(testEvaluate);
            try {
                test = eval(testExpected);
            } catch (t) {
                testError = t.toString();
            }
            if (typeof erg != "undefined" && erg != null && erg.toString().length > 80)
                res = erg.toString().substr(0, 79) + "...";
            else
                res = erg;
            ergebnis.setAttribute('title', erg);
            ergebnis.innerHTML = res;
            if (test)
                addRow(testName, testEvaluate, ergebnis.outerHTML, success);
            else
                addRow(testName, testEvaluate, ergebnis.outerHTML, error);
            if (testError.length > 0)
                alert(testError);
        } catch (e) {
            addRow(testName, testEvaluate, e, error);
        }
        return erg;
    }

    function addRow(test, call, result, status) {
        var res = "";
        var nummer = -1;
        var tabellen_id = "t1";
        var trhtml = document.getElementById(tabellen_id).insertRow(nummer);
        var tdhtml1 = document.createElement("td");
        var tdhtml2 = document.createElement("td");
        var tdhtml3 = document.createElement("td");
        var tdhtml4 = document.createElement("td");
        tdhtml1.innerHTML = test; // content
        tdhtml2.innerHTML = call;
        tdhtml3.innerHTML = result;
        tdhtml4.innerHTML = status;
        trhtml.appendChild(tdhtml1);
        trhtml.appendChild(tdhtml2);
        trhtml.appendChild(tdhtml3);
        trhtml.appendChild(tdhtml4);
    }
</script>
    </TABLE>
</body>
</html>